function $d(a){return document.getElementById(a)}function hasClass(a,b){return!!a.className.match(RegExp("(\\s|^)"+b+"(\\s|$)"))}function addClass(a,b){hasClass(a,b)||(a.className+=" "+b)}function removeClass(a,b){hasClass(a,b)&&(a.className=a.className.replace(RegExp("(\\s|^)"+b+"(\\s|$)")," "))}function Tplayer(a,b,c,d,e){tplayer.videoid=e,tplayer.warp=a,tplayer.vsrc=b,tplayer.vposter=c,tplayer.serverurl=d,tplayer.geturl=tplayer.serverurl+"get/?id="+tplayer.videoid,tplayer.sendurl=tplayer.serverurl+"send/",window.onload=function(){function a(a){var b=encodeURIComponent(a)+"=",c="",d=document.cookie.indexOf(b),e=null;return d>-1&&(e=document.cookie.indexOf(";",d),-1==e&&(e=document.cookie.length),c=decodeURIComponent(document.cookie.substring(d+b.length,e))),c}function b(){var a,b;for(tplayer.time2?(tplayer.time=tplayer.time2,tplayer.time2=0):(tplayer.time++,$d("video-control-nowtime").innerHTML=d(tplayer.ddom.currentTime).m+":"+d(tplayer.ddom.currentTime).s,$d("video-control-range").value=1e4*(tplayer.ddom.currentTime/tplayer.ddom.duration),a=10*tplayer.ddom.currentTime,(a+10<tplayer.time||a-10>tplayer.time)&&(tplayer.time2=parseInt(a))),b=0;b<tplayer.data.length;b++)tplayer.data[b].time==tplayer.time&&tplayer.send(tplayer.data[b].text,tplayer.data[b].color,tplayer.data[b].place)}function c(){var a,b;for(clearInterval(tplayer.Interval),tplayer.dsq=0,$d("dm-spinner").style.display="block",a=$d("danmu").getElementsByTagName("div"),b=a.length-1;b>=0;b--)addClass(a[b],"dm-suspend")}function d(a){var b,c=parseInt(a/60);return b=parseInt(a%60)>=10?parseInt(a%60):"0"+parseInt(a%60),{m:c,s:b}}function e(){h()?g():f()}function f(){var b,c,d,a=document.getElementById("dm-video-warp");for(a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen(),b=$d("danmu").offsetWidth,c=$d("danmu").getElementsByTagName("div"),d=c.length-1;d>=0;d--)hasClass(c[d],"dm-left")&&(c[d].style.transform="translateX(-"+b+"px)")}function g(){tplayer.full=0,document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}function h(){var a=document.webkitIsFullScreen||document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;return a}function i(){$d("dm-video-y").style.opacity="1",tplayer.sjc++,setTimeout(j,2e3,tplayer.sjc)}function j(a){a>=tplayer.sjc&&($d("dm-video-y").style.opacity="0")}tplayer.v='<div class="dm-video-warp"id="dm-video-warp"><div class="dm-video-main"id="dm-video-main"><video class="dm-video"id="dm-video-x" src="'+tplayer.vsrc+'" poster="'+tplayer.vposter+'"></video><div id="danmu"></div><div class="dm-oneplay"id="dm-oneplay"><svg style="width: 200px;height:200px;"class="dm-icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M836.1152 512 194.2848 886.4v-748.8000000000001L836.1152 512z"/></svg></div><div class="dm-spinner"id="dm-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div><div id="dm-video-y"class="dm-video-y"><div class="dm-send"id="dm-send"><div class="dm-logo-small"></div><input class="dm-tucao"type="text"id="dm-text"required="true"placeholder="客官，不来吐槽一下吗?"autocomplete="off"><input type="text"id="dm-color"style="display:none"value="#fff"><input type="text"id="dm-place"style="display:none"value="1"><div class="dm-colorbar"id="dm-colorbar"><div class="dm-place"></div></div><input class="dm-post"id="dm-up"type="submit"value="发送"><div id="color-picker"class="cp-small"></div></div><div id="video-control"class="video-control"><svg id="video-control-play"class="dm-icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M836.1152 512 194.2848 886.4v-748.8000000000001L836.1152 512z"/></svg><svg id="video-control-paused"class="dm-icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M256.033769 192.014198l127.977743 0 0 639.933741-127.977743 0 0-639.933741ZM639.976 191.982l127.993 0 0 639.966-127.993 0 0-639.966z"/></svg><span id="video-control-nowtime">0:00</span><!--<input id="video-control-paused"type="button"value="暂停">--><input id="video-control-range"type="range"name="points"min="0"max="10000"style="width:64%"value="0"/><span id="video-control-alltime" style="padding-right:6px">0:00</span><div class="dm-dmk"id="dm-dmk">弹</div><div class="dm-syk"id="dm-syk">♫<input id="dm-syk-range"style="width:70px;"type="range"name="points"min="0"max="100"value="100"/></div><svg id="video-full"style="width: 20px;float: right;padding-right:30px"xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"class="dm-icon"style=""viewBox="0 0 1024 1024"version="1.1"p-id="1427"><defs><style type="text/css"><![CDATA[]]></style></defs><path d="M971.862 52.538c-10.964-10.992-25.546-17.044-41.056-17.044L429.616 35.494l0 79.362 479.86 0 0 465.288 79.364 0L988.84 93.524C988.84 78.024 982.802 63.46 971.862 52.538z"p-id="1428"/><path d="M115.092 429.62 35.728 429.62l0 500.854c0 15.5 6.038 30.066 16.982 40.994 10.966 10.988 25.544 17.04 41.05 17.04l469.182 0 0-79.364L115.092 909.144 115.092 429.62z"p-id="1429"/><path d="M127.16 193.578l73.198 73.198-0.034 0.034 40.438 40.44 14.164 14.096 152.616 152.616c8.796 8.796 20.492 13.64 32.932 13.64 12.442 0 24.138-4.846 32.936-13.644 18.158-18.16 18.156-47.708-0.002-65.866l-141.318-141.318 0.094-0.094-40.484-40.486-14.162-13.97L192.812 127.492l146.47 0 0-92L101.16 35.492c-36.392 0-66 29.608-66 66l0 237.972 92 0L127.16 193.578z"p-id="1430"/><path d="M896.578 830.358l-73.198-73.198 0.034-0.034-40.44-40.44-14.148-14.084-152.622-152.62c-8.796-8.8-20.496-13.648-32.942-13.648-12.444 0-24.14 4.848-32.94 13.646-18.148 18.156-18.148 47.702 0.004 65.866l141.31 141.306-0.094 0.094 40.492 40.494 14.16 13.974 84.728 84.726-146.734 0 0 92 238.386 0c36.392 0 66-29.608 66-66l0-237.96-92 0L896.574 830.358z"p-id="1431"/></svg></div></div></div></div>',tplayer.warp.innerHTML=tplayer.v,tplayer.ddom=$d("dm-video-x"),tplayer.time=0,tplayer.sjc=0,tplayer.dsq=0,tplayer.leftarr=[],tplayer.toparr=[],tplayer.dmheight=31,tplayer.time2=0,tplayer.width=tplayer.ddom.offsetWidth,tplayer.height=tplayer.ddom.offsetHeight,tplayer.getdanmu=function(){var a;a=new XMLHttpRequest,a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=JSON.parse(a.responseText);tplayer.data=b.data}},a.open("GET",tplayer.geturl,!0),a.send()},tplayer.getdanmu(),tplayer.send=function(a,b,c,d){var e,f,g,h,i,j,k;tplayer.width=tplayer.ddom.offsetWidth,tplayer.height=tplayer.ddom.offsetHeight,e=document.createElement("div"),e.appendChild(document.createTextNode(a)),e.style.color=b,d&&(e.style.border="1px solid #fff"),1==c?(f=tplayer.getlefttop(),e.style.top=f*tplayer.dmheight+"px",tplayer.leftarr[f]=1,e.className="danmu dm-left",e.style.transform="translateX(-"+tplayer.width+"px)",g=$d("danmu").appendChild(e),h=g.offsetWidth,i=h+tplayer.width,j=i/10,k=h/j,setTimeout(function(){tplayer.leftarr[f]=0},1e3*k+500),setTimeout(function(){tplayer.danmuhide(g,1)},16e3)):2==c&&(e.className="danmu dm-top",f=tplayer.gettoptop(),e.style.top=f*tplayer.dmheight+"px",tplayer.toparr[f]=1,g=$d("danmu").appendChild(e),setTimeout(function(){tplayer.danmuhide(g,2,f)},5e3))},tplayer.danmuhide=function(a,b,c){hasClass(a,"dm-suspend")?setTimeout(function(){tplayer.danmuhide(a,b,c)},5e3):(a.remove(),2==b&&(tplayer.toparr[c]=0))},tplayer.getlefttop=function(){var a,b;for(b=0;b<=tplayer.leftarr.length;b++)if(!tplayer.leftarr[b]){a=b;break}return a},tplayer.gettoptop=function(){var a,b;for(b=0;b<=tplayer.toparr.length;b++)if(!tplayer.toparr[b]){a=b;break}return a},$d("dm-dmk").onclick=function(){"dm-dmk"==this.className?(this.className="dm-dmk dm-dmk-c",$d("danmu").style.opacity="0"):(this.className="dm-dmk",$d("danmu").style.opacity="1")},$d("dm-text").onkeydown=function(a){var b=a||window.event||arguments.callee.caller.arguments[0];13==b.keyCode&&$d("dm-up").onclick()},$d("dm-up").onclick=function(){var a,b;tplayer.send($d("dm-text").value,$d("dm-color").value,$d("dm-place").value,1),$d("dm-text").readonly="readonly",$d("dm-up").disabled="true",$d("dm-up").style.background="#777479",setTimeout(function(){$d("dm-text").value="",$d("dm-up").disabled="",$d("dm-up").style.background="#8715EF"},500),a={id:tplayer.videoid,text:$d("dm-text").value,color:$d("dm-color").value,time:tplayer.time,place:$d("dm-place").value},a=function(a){var c,b="";for(c in a)b+=c+"="+a[c]+"&";return b}(a),b=new XMLHttpRequest,b.open("POST",tplayer.sendurl,!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.onreadystatechange=function(){var c,a=b;4==a.readyState&&200==a.status&&(c=a.responseText,console.log(c))},b.send(a)},$d("video-control-paused").onclick=function(){var a,b;for(clearInterval(tplayer.Interval),tplayer.dsq=0,a=$d("danmu").getElementsByTagName("div"),this.style.display="none",$d("video-control-play").style.display="inline-block",tplayer.ddom.pause(),b=a.length-1;b>=0;b--)addClass(a[b],"dm-suspend");$d("dm-spinner").style.display="none"},$d("dm-oneplay").onclick=function(){this.style.display="none",$d("video-control-play").onclick()},$d("danmu").onclick=function(){$d("dm-video-x").paused?$d("video-control-play").onclick():$d("video-control-paused").onclick()},$d("video-control-play").onclick=function(){var a,c;for($d("dm-oneplay").style.display="none",0==tplayer.dsq&&(tplayer.Interval=setInterval(b,100),tplayer.dsq=1),$d("dm-video-y").style.opacity="0",a=$d("danmu").getElementsByTagName("div"),this.style.display="none",$d("video-control-paused").style.display="inline-block",tplayer.ddom.play(),c=a.length-1;c>=0;c--)removeClass(a[c],"dm-suspend")},$d("dm-video-y").onmousemove=function(){i()},$d("video-control-range").onclick=function(){var a=this.value;tplayer.ddom.currentTime=1e-4*parseInt(a)*tplayer.ddom.duration,tplayer.time2=1e-4*parseInt(a)*tplayer.ddom.duration,tplayer.time=1e-4*parseInt(a)*tplayer.ddom.duration},tplayer.changersound=function(){var a=7,b=new Date;b.setTime(b.getTime()+1e3*60*60*24*a),document.cookie="tpsound="+parseInt($d("dm-syk-range").value)+";expires="+b.toGMTString()+"&path=/"},tplayer.soundcookie=a("tpsound"),tplayer.soundcookie?($d("dm-syk-range").value=tplayer.soundcookie,$d("dm-video-x").volume=.01*parseInt($d("dm-syk-range").value)):tplayer.changersound(),$d("dm-syk").onchange=function(){var a=.01*parseInt($d("dm-syk-range").value);$d("dm-video-x").volume=a,tplayer.changersound()},$d("dm-video-x").addEventListener("waiting",c),$d("dm-video-x").addEventListener("playing",function(){var a,c;for(0==tplayer.dsq&&(tplayer.Interval=setInterval(b,100),tplayer.dsq=1),a=$d("danmu").getElementsByTagName("div"),$d("dm-spinner").style.display="none",$d("video-control-alltime").innerHTML=d(tplayer.ddom.duration).m+":"+d(tplayer.ddom.duration).s,c=a.length-1;c>=0;c--)removeClass(a[c],"dm-suspend")}),document.onkeydown=function(a){var b=a||window.event||arguments.callee.caller.arguments[0];i(),b&&39==b.keyCode&&($d("video-control-range").value=parseInt($d("video-control-range").value)+50),b&&37==b.keyCode&&($d("video-control-range").value=parseInt($d("video-control-range").value)-50),b&&32==b.keyCode&&$d("danmu").onclick(),b&&38==b.keyCode&&($d("dm-syk-range").value=parseInt($d("dm-syk-range").value)+1,$d("dm-syk").onclick()),b&&40==b.keyCode&&($d("dm-syk-range").value=parseInt($d("dm-syk-range").value)-1,$d("dm-syk").onclick())},document.getElementById("dm-colorbar").onclick=function(){document.getElementById("color-picker").style.display="block"==document.getElementById("color-picker").style.display?"none":"block"},ColorPicker(document.getElementById("color-picker"),function(a){document.getElementById("dm-color").value=a,document.getElementById("dm-colorbar").style.background=a}),$d("video-full").addEventListener("click",e),$d("dm-place2").onclick=function(){1==$d("dm-place").value?($d("dm-place").value=2,this.innerText="顶部弹幕"):($d("dm-place").value=1,this.innerText="正向弹幕")}}}var tplayer={};