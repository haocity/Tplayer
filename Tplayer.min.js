function $d(a){return document.getElementById(a)}function $c(a){return document.querySelectorAll(a)}function hasClass(a,b){return!!a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function addClass(a,b){hasClass(a,b)||(a.className+=" "+b)}function removeClass(a,b){hasClass(a,b)&&(a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," "))}function getstyle(a){var b,c,d;for(b=0;b<document.styleSheets.length;b++)for(c=document.styleSheets[b].cssRules?document.styleSheets[b].cssRules:document.styleSheets[b].rules,d=0;d<c.length;d++)if(c[d].selectorText==a)return c[d].style}function Tplayer(a,b,c,d,e,f){var g=new Object;g.videoid=e,g.warp=a,g.vsrc=b,g.vposter=c,g.serverurl=d,g.geturl=g.serverurl+"get/?id="+g.videoid,g.sendurl=g.serverurl+"send/",g.videotype=f,window.onload=function(){function b(a){getstyle(".dm-left").animation="dmleft "+a+"s linear",getstyle(".dm-left").webkitAnimation="dmleft "+a+"s linear"}function c(a){var b=encodeURIComponent(a)+"=",c="",d=document.cookie.indexOf(b),e=null;return d>-1&&(e=document.cookie.indexOf(";",d),-1==e&&(e=document.cookie.length),c=decodeURIComponent(document.cookie.substring(d+b.length,e))),c}function d(){var a=g.Element.duration;a?(g.alltime=a,$d("video-control-alltime").innerHTML=l(g.alltime).m+":"+l(g.alltime).s):setTimeout(function(){d()},500)}function e(){var b,c,d,a=g.Element.currentTime;for($d("tranger-a").style.width=100*(a/g.alltime)+"%",b=g.Element.buffered,c=0;c<b.length;c++)if(b.start(c)<=a&&a<b.end(c)){d=100*(g.Element.buffered.end(c)/g.alltime)+"%",$d("tranger-c").style.width!=d&&($d("tranger-c").style.width=d);break}if(g.nowdata)for(c=0;c<g.nowdata.length;c++)g.nowdata[c]&&g.nowdata[c].time==parseInt(10*g.Element.currentTime)&&(g.send(g.nowdata[c].text,g.nowdata[c].color,g.nowdata[c].place),delete g.nowdata[c])}function f(a){var b=a.offsetTop;return null!=a.offsetParent&&(b+=f(a.offsetParent)),b}function h(a){var b=a.offsetLeft;return null!=a.offsetParent&&(b+=h(a.offsetParent)),b}function j(a,b){var c=a.clientX-h(b),d=a.clientY-f(b),e=c/b.offsetWidth,g=d/b.offsetTop;return{x:c,y:d,w:b.offsetWidth,xbl:e,ybl:g}}function k(){var a,b;for(clearInterval(g.Interval),g.dsq=0,$d("dm-spinner").style.display="block",a=$d("danmu").getElementsByTagName("div"),b=a.length-1;b>=0;b--)addClass(a[b],"dm-suspend")}function l(a){var b,c=parseInt(a/60);return b=parseInt(a%60)>=10?parseInt(a%60):"0"+parseInt(a%60),{m:c,s:b}}function m(){$d("dm-video-y").style.opacity="1",g.sjc++,setTimeout(n,2e3,g.sjc)}function n(a){a>=g.sjc&&($d("dm-video-y").style.opacity="0")}var a,o,p,q,r,s,t,u,v,w,x;for(g.v='<div class="dm-video-warp"id="dm-video-warp"><div class="dm-video-main"id="dm-video-main"><ul class="dm-rightmenu"><li class="tp-speend-con">播放速度 <ul class="tp-speend"><li>0.5</li><li>0.75</li><li>正常</li><li>1.25</li><li>1.5</li><li>2</li></ul></li><a href="https://github.com/haocity/Tplayer/issues" target="_blank"><li>意见反馈</li></a><a href="https://www.haotown.cn/about.html" target="_blank"><li>关于作者</li></a><a href="https://github.com/haocity/Tplayer" target="_blank"><li>About Tplayer</li></a></ul><video class="dm-video"id="dm-video-x"></video><div id="danmu"></div><div class="dm-oneplay"id="dm-oneplay"><svg style="width: 200px;height:200px;"class="dm-icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M836.1152 512 194.2848 886.4v-748.8000000000001L836.1152 512z"/></svg></div><div class="dm-spinner"id="dm-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div><div id="dm-video-y"class="dm-video-y"><div class="dm-send"id="dm-send"><div class="dm-logo-small"></div><input class="dm-tucao"type="text"id="dm-text"required="true"placeholder="客官，不来吐槽一下吗?"autocomplete="off"><div class="tp-color"><div class="tp-color-bo" id="tp-color-bo" style="background-color: rgb(255, 255, 255)"></div><div class="tp-con" id="tp-con"><div class="tp-place" id="tp-place">◀滚动弹幕</div><div id="tp-color-warp"></div></div></div><input class="dm-post"id="dm-up"type="submit"value="发送"></div><div id="video-control"class="video-control"><div style="float:right;"><span id="video-control-alltime" style="padding-right:6px">0:00</span><div class="dm-dmk"id="dm-dmk">弹</div><div class="dm-syk"id="dm-syk"><span class="dm-syk-ico">♫</span><input id="dm-syk-range" type="range"name="points"min="0"max="100"value="100"/></div><svg id="video-full"style="width: 20px;padding-right:30px;top: 9px;"xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"class="dm-icon"style=""viewBox="0 0 1024 1024"version="1.1"p-id="1427"><defs><style type="text/css"><![CDATA[]]></style></defs><path d="M971.862 52.538c-10.964-10.992-25.546-17.044-41.056-17.044L429.616 35.494l0 79.362 479.86 0 0 465.288 79.364 0L988.84 93.524C988.84 78.024 982.802 63.46 971.862 52.538z"p-id="1428"/><path d="M115.092 429.62 35.728 429.62l0 500.854c0 15.5 6.038 30.066 16.982 40.994 10.966 10.988 25.544 17.04 41.05 17.04l469.182 0 0-79.364L115.092 909.144 115.092 429.62z"p-id="1429"/><path d="M127.16 193.578l73.198 73.198-0.034 0.034 40.438 40.44 14.164 14.096 152.616 152.616c8.796 8.796 20.492 13.64 32.932 13.64 12.442 0 24.138-4.846 32.936-13.644 18.158-18.16 18.156-47.708-0.002-65.866l-141.318-141.318 0.094-0.094-40.484-40.486-14.162-13.97L192.812 127.492l146.47 0 0-92L101.16 35.492c-36.392 0-66 29.608-66 66l0 237.972 92 0L127.16 193.578z"p-id="1430"/><path d="M896.578 830.358l-73.198-73.198 0.034-0.034-40.44-40.44-14.148-14.084-152.622-152.62c-8.796-8.8-20.496-13.648-32.942-13.648-12.444 0-24.14 4.848-32.94 13.646-18.148 18.156-18.148 47.702 0.004 65.866l141.31 141.306-0.094 0.094 40.492 40.494 14.16 13.974 84.728 84.726-146.734 0 0 92 238.386 0c36.392 0 66-29.608 66-66l0-237.96-92 0L896.574 830.358z"p-id="1431"/></svg></div><div style="float: left;"><svg id="video-control-play"class="dm-icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M836.1152 512 194.2848 886.4v-748.8000000000001L836.1152 512z"/></svg><svg id="video-control-paused"style="display:none" class="dm-icon"viewBox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M256.033769 192.014198l127.977743 0 0 639.933741-127.977743 0 0-639.933741ZM639.976 191.982l127.993 0 0 639.966-127.993 0 0-639.966z"/></svg><span id="video-control-nowtime">0:00</span></div><div id="tranger" class="tranger" ><div class="tranger-a" id="tranger-a"></div><div class="tranger-b"></div><div id="tranger-c" class="tranger-c"></div></div></div></div></div></div>',g.warp.innerHTML=g.v,g.Element=$d("dm-video-x"),"flv"==g.videotype?flvjs.isSupported()?(a=flvjs.createPlayer({type:"flv",url:g.vsrc}),a.attachMediaElement(g.Element),a.load()):console.log("flv.js没有加载完全"):g.Element.src=g.vsrc,g.Element.poster=g.vposter,g.danmuelement=$d("danmu"),g.sjc=0,g.dsq=0,g.leftarr=[],g.toparr=[],g.dmheight=31,g.dmplace=1,g.width=g.Element.offsetWidth,g.height=g.Element.offsetHeight,g.getdanmu=function(){var a;a=new XMLHttpRequest,a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(g.data=a.responseText,g.nowdata=JSON.parse(g.data).data)},a.open("GET",g.geturl,!0),a.send()},g.getdanmu(),g.send=function(a,b,c,d){var e,f,h,i,j,k,l;g.width=g.Element.offsetWidth,g.height=g.Element.offsetHeight,e=document.createElement("div"),e.appendChild(document.createTextNode(a)),e.style.color=b,d&&(e.style.border="1px solid #fff"),1==c?(f=g.getlefttop(),e.style.top=f*g.dmheight+"px",g.leftarr[f]=1,e.className="danmu dm-left",e.style.transform="translateX(-"+g.width+"px)",h=$d("danmu").appendChild(e),i=h.offsetWidth,j=i+g.width,k=j/10,l=i/k,setTimeout(function(){g.leftarr[f]=0},1e3*l+500),e.addEventListener("webkitAnimationEnd",g.dmend),e.addEventListener("animationend",g.dmend)):2==c&&(e.className="danmu dm-top",f=g.gettoptop(),e.style.top=f*g.dmheight+"px",g.toparr[f]=1,h=$d("danmu").appendChild(e),setTimeout(function(){g.danmuhide(h,f)},5e3))},g.dmend=function(){g.danmuelement.removeChild(this)},g.danmuhide=function(a,b){g.Element.paused?setTimeout(function(){g.danmuhide(a,b)},10*g.width+1e3):(a.remove(),g.toparr[b]=0)},g.getlefttop=function(){var a,b;for(b=0;b<=g.leftarr.length;b++)if(!g.leftarr[b]){a=b;break}return a},g.gettoptop=function(){var a,b;for(b=0;b<=g.toparr.length;b++)if(!g.toparr[b]){a=b;break}return a},$d("dm-dmk").addEventListener("click",function(){"dm-dmk"==this.className?(this.className="dm-dmk dm-dmk-c",$d("danmu").style.opacity="0"):(this.className="dm-dmk",$d("danmu").style.opacity="1")}),$d("dm-text").onkeydown=function(a){var b=a||window.event||arguments.callee.caller.arguments[0];13==b.keyCode&&$d("dm-up").click()},$d("dm-up").addEventListener("click",function(){var a,b;g.send($d("dm-text").value,$d("tp-color-bo").style.backgroundColor,g.dmplace,1),$d("dm-text").readonly="readonly",$d("dm-up").disabled="true",$d("dm-up").style.background="#777479",setTimeout(function(){$d("dm-text").value="",$d("dm-up").disabled="",$d("dm-up").style.background="#8715EF"},500),a={id:g.videoid,text:$d("dm-text").value,color:$d("tp-color-bo").style.backgroundColor,time:parseInt(10*g.Element.currentTime),place:g.dmplace},a=function(a){var c,b="";for(c in a)b+=c+"="+a[c]+"&";return b}(a),b=new XMLHttpRequest,b.open("POST",g.sendurl,!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.onreadystatechange=function(){var c,a=b;4==a.readyState&&200==a.status&&(c=a.responseText,console.log(c))},b.send(a)}),$d("video-control-play").onclick=function(){var a,b;for($d("dm-oneplay").style.display="none",0==g.dsq&&(g.Interval=setInterval(e,100),g.dsq=1),$d("dm-video-y").style.opacity="0",a=$d("danmu").getElementsByTagName("div"),this.style.display="none",$d("video-control-paused").style.display="inline-block",g.Element.play(),b=a.length-1;b>=0;b--)removeClass(a[b],"dm-suspend")},$d("video-control-paused").onclick=function(){var a,b;for(clearInterval(g.Interval),g.dsq=0,a=$d("danmu").getElementsByTagName("div"),this.style.display="none",$d("video-control-play").style.display="inline-block",g.Element.pause(),b=a.length-1;b>=0;b--)addClass(a[b],"dm-suspend");$d("dm-spinner").style.display="none"},$d("dm-oneplay").addEventListener("click",function(){this.style.display="none",$d("video-control-play").onclick()}),$d("dm-video-y").onmousemove=function(){m()},g.changersound=function(){var a=7,b=new Date;b.setTime(b.getTime()+1e3*60*60*24*a),document.cookie="tpsound="+parseInt($d("dm-syk-range").value)+";expires="+b.toGMTString()+"&path=/"},g.soundcookie=c("tpsound"),g.soundcookie?($d("dm-syk-range").value=g.soundcookie,g.Element.volume=.01*parseInt($d("dm-syk-range").value)):g.changersound(),d(),$d("dm-syk").onmousemove=function(){$d("dm-syk-range").style.width="70px",$d("dm-syk-range").style.opacity="1"},$d("dm-syk").onmouseout=function(){$d("dm-syk-range").style.width="1px",$d("dm-syk-range").style.opacity="0"},$d("dm-syk-range").addEventListener("click",function(){var a=.01*parseInt($d("dm-syk-range").value);g.Element.volume=a,g.changersound()}),setInterval(function(){var b,a=g.Element.currentTime;$d("video-control-nowtime").innerHTML=l(a).m+":"+l(a).s,b=$d("dm-send").offsetWidth-280+"px",$d("dm-text").style.width!=b&&($d("dm-text").style.width=b)},1e3),$d("tranger").onmousedown=function(){var a=j(event,this);$d("tranger-a").style.width=100*a.xbl+"%",g.Element.currentTime=a.xbl*g.alltime,g.nowdata=JSON.parse(g.data).data},g.Element.addEventListener("waiting",k),g.Element.addEventListener("playing",function(){var a,b;for(0==g.dsq&&(g.Interval=setInterval(e,100),g.dsq=1),a=$d("danmu").getElementsByTagName("div"),$d("dm-spinner").style.display="none",$d("video-control-alltime").innerHTML=l(g.alltime).m+":"+l(g.alltime).s,b=a.length-1;b>=0;b--)removeClass(a[b],"dm-suspend")}),document.onkeydown=function(a){var c,b=a||window.event||arguments.callee.caller.arguments[0];m(),b&&39==b.keyCode&&(c=g.Element.currentTime,g.Element.currentTime=c+5),b&&37==b.keyCode&&(c=g.Element.currentTime,g.Element.currentTime=c-5,g.nowdata=JSON.parse(g.data).data),b&&32==b.keyCode&&$d("danmu").click(),b&&38==b.keyCode&&($d("dm-syk-range").value=parseInt($d("dm-syk-range").value)+1,$d("dm-syk-range").click()),b&&40==b.keyCode&&($d("dm-syk-range").value=parseInt($d("dm-syk-range").value)-1,$d("dm-syk-range").click())},$d("video-full").addEventListener("click",function(){var a=$d("dm-video-warp");document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(),setTimeout(function(){var a,c;for(g.width=g.Element.offsetWidth,a=$d("danmu").getElementsByTagName("div"),b(g.width/100),c=a.length-1;c>=0;c--)hasClass(a[c],"dm-left")&&(a[c].style.transform="translateX(-"+g.width+"px)")},1e3)}),tpcolor=new Object,tpcolor.arr=new Array("#FFFFFF","#000000","#4ab0c6","#555656","#09b745","#f86141","#FFEB3B","#4d38d8","#fe67c1","#ff9c07"),o=255;o>=0;o-=25)for(p=0;255>=p;p+=25)for(q=0;255>=q;q+=25)tpcolor.arr.push("rgb("+o+","+p+","+q+")");for(r=$d("tp-con"),s=$d("tp-color-warp"),$d("tp-color-bo").addEventListener("click",function(){r.style.display="block"==r.style.display?"none":"block"}),tpcolor.i=0;tpcolor.i<tpcolor.arr.length;tpcolor.i++)t=document.createElement("div"),t.className="tp-color",u=document.createElement("div"),u.className="tp-color-main",u.style.background=tpcolor.arr[tpcolor.i],u.addEventListener("click",function(){$d("tp-color-bo").style.backgroundColor=this.style.background}),t.appendChild(u),s.appendChild(t);for($c(".tp-speend-con")[0].addEventListener("click",function(){var a=$c(".tp-speend")[0];a.style.display="block"==a.style.display?"none":"block"}),v=$c(".tp-speend")[0].childNodes,i=0;i<v.length;i++)w=v[i],x=parseFloat(v[i].innerText).toFixed(2),w.onclick="NaN"!=x?function(){var a=parseFloat(this.innerText).toFixed(2);$c(".dm-video")[0].playbackRate=a}:function(){$c(".dm-video")[0].playbackRate=1};$c("#danmu")[0].onmousedown=function(){var c,d,e,f,h,i,j,a=$c(".dm-video-warp")[0],b=$c(".dm-rightmenu")[0];2==event.button?(b.style.display="block",c=window.event||arguments[0],f=$d("danmu").offsetHeight,h=$d("danmu").offsetWidth,f==document.documentElement.clientHeight?(e=c.clientY,d=c.clientX,d+b.offsetWidth>h&&(d=h-b.offsetWidth),e+b.offsetWidth>f&&(e=f-b.offsetHeight)):(e=c.clientY+document.body.scrollTop-a.offsetTop,d=c.clientX-a.offsetLeft,i=a.offsetWidth,j=a.offsetHeight,d+b.offsetWidth>i&&(d=i-b.offsetWidth),e+b.offsetHeight>j&&(e=j-b.offsetHeight)),window.document.all?(this.IContextmenuHander=function(){return!1},document.attachEvent("oncontextmenu",this.IContextmenuHander)):(this.IContextmenuHander=document.oncontextmenu,document.oncontextmenu=function(){return!1}),b.style.top=e+"px",b.style.left=d+"px"):0==event.button&&("block"==b.style.display?b.style.display="none":g.Element.paused?$d("video-control-play").onclick():$d("video-control-paused").onclick())},$d("tp-place").addEventListener("click",function(){1==g.dmplace?(g.dmplace=2,this.innerText="▲顶部弹幕"):(g.dmplace=1,this.innerText="◀滚动弹幕")})}}