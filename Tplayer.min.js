function $d(a){return document.getElementById(a)}function $c(a){return document.querySelectorAll(a)}function hasClass(a,b){return!!a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function addClass(a,b){hasClass(a,b)||(a.className+=" "+b)}function removeClass(a,b){hasClass(a,b)&&(a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," "))}function getstyle(a){var b,c,d;for(b=0;b<document.styleSheets.length;b++)for(c=document.styleSheets[b].cssRules?document.styleSheets[b].cssRules:document.styleSheets[b].rules,d=0;d<c.length;d++)if(c[d].selectorText==a)return c[d].style}function Tplayer(a,b,c,d,e,f){tplayer.ele=new Object,tplayer.videoid=e,tplayer.ele.warp=a,tplayer.vsrc=b,tplayer.vposter=c,tplayer.serverurl=d,tplayer.geturl=tplayer.serverurl+"get/?id="+tplayer.videoid,tplayer.sendurl=tplayer.serverurl+"send/",tplayer.videotype=f,window.onload=function(){function b(a){getstyle(".dm-left").animation="dmleft "+a+"s linear",getstyle(".dm-left").webkitAnimation="dmleft "+a+"s linear"}function c(a){var b=encodeURIComponent(a)+"=",c="",d=document.cookie.indexOf(b),e=null;return d>-1&&(e=document.cookie.indexOf(";",d),-1==e&&(e=document.cookie.length),c=decodeURIComponent(document.cookie.substring(d+b.length,e))),c}function d(){var a=tplayer.ele.video.duration;a?(tplayer.alltime=a,tplayer.ele.alltime.innerHTML=k(tplayer.alltime).m+":"+k(tplayer.alltime).s):setTimeout(function(){d()},500)}function e(){var b,c,d,a=tplayer.ele.video.currentTime;for(tplayer.ele.tranger_a.style.width=100*(a/tplayer.alltime)+"%",b=tplayer.ele.video.buffered,c=0;c<b.length;c++)if(b.start(c)<=a&&a<b.end(c)){d=100*(tplayer.ele.video.buffered.end(c)/tplayer.alltime)+"%",tplayer.ele.tranger_c.style.width!=d&&(tplayer.ele.tranger_c.style.width=d);break}if(tplayer.nowdata)for(c=0;c<tplayer.nowdata.length;c++)tplayer.nowdata[c]&&tplayer.nowdata[c].time==parseInt(10*tplayer.ele.video.currentTime)&&(tplayer.send(tplayer.nowdata[c].text,tplayer.nowdata[c].color,tplayer.nowdata[c].place),delete tplayer.nowdata[c])}function f(a){var b=a.offsetTop;return null!=a.offsetParent&&(b+=f(a.offsetParent)),b}function g(a){var b=a.offsetLeft;return null!=a.offsetParent&&(b+=g(a.offsetParent)),b}function h(a,b){var c=a.clientX-g(b),d=a.clientY-f(b),e=c/b.offsetWidth,h=d/b.offsetTop;return{x:c,y:d,w:b.offsetWidth,xbl:e,ybl:h}}function j(){var a,b;for(clearInterval(tplayer.Interval),tplayer.dsq=0,tplayer.ele.dm_spinner.style.display="block",a=tplayer.ele.danmu_warp.getElementsByTagName("div"),b=a.length-1;b>=0;b--)addClass(a[b],"dm-suspend")}function k(a){var b,c=parseInt(a/60);return b=parseInt(a%60)>=10?parseInt(a%60):"0"+parseInt(a%60),{m:c,s:b}}function l(){tplayer.ele.dm_video_y.style.opacity="1",tplayer.sjc++,setTimeout(m,2e3,tplayer.sjc)}function m(a){a>=tplayer.sjc&&(tplayer.ele.dm_video_y.style.opacity="0")}var a,n,o,p,q,r,s,t,u,v,w;for(tplayer.v='<div class="dm-video-warp"><div class="dm-video-main"><ul class="dm-rightmenu"><li class="tp-speend-con">播放速度<ul class="tp-speend"><li>0.5</li><li>0.75</li><li>正常</li><li>1.25</li><li>1.5</li><li>2</li></ul></li><a href="https://github.com/haocity/Tplayer/issues"target="_blank"><li>意见反馈</li></a><a href="https://www.haotown.cn/about.html"target="_blank"><li>关于作者</li></a><a href="https://github.com/haocity/Tplayer"target="_blank"><li>About Tplayer</li></a></ul><video class="dm-video"></video><div class="danmu-warp"></div><div class="dm-oneplay"><svg style="width: 200px;height:200px;"class="dm-icon"viewbox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M836.1152 512 194.2848 886.4v-748.8000000000001L836.1152 512z"/></svg></div><div class="dm-spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div><div class="dm-video-y"><div class="dm-send"><div class="dm-logo-small"></div><input type="text"class="dm-text"required="true"placeholder="客官，不来吐槽一下吗?"autocomplete="off"/><div class="tp-color"><div class="tp-color-bo"style="background-color: rgb(255, 255, 255)"></div><div class="tp-con"><div class="tp-place">◀滚动弹幕</div><div class="tp-color-warp"></div></div></div><input class="dm-up"type="submit"value="发送"/></div><div class="video-control"><div style="float:right;"><span class="video-control-alltime"style="padding-right:6px">0:00</span><div class="dm-dmk">弹</div><div class="dm-syk"><span class="dm-syk-ico">♫</span><input class="dm-syk-range"type="range"name="points"min="0"max="100"value="100"/></div><svg class="video-full" xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"class="dm-icon"viewbox="0 0 1024 1024"version="1.1"p-id="1427"><defs><style type="text/css"><![CDATA[]]></style></defs><path d="M971.862 52.538c-10.964-10.992-25.546-17.044-41.056-17.044L429.616 35.494l0 79.362 479.86 0 0 465.288 79.364 0L988.84 93.524C988.84 78.024 982.802 63.46 971.862 52.538z"p-id="1428"/><path d="M115.092 429.62 35.728 429.62l0 500.854c0 15.5 6.038 30.066 16.982 40.994 10.966 10.988 25.544 17.04 41.05 17.04l469.182 0 0-79.364L115.092 909.144 115.092 429.62z"p-id="1429"/><path d="M127.16 193.578l73.198 73.198-0.034 0.034 40.438 40.44 14.164 14.096 152.616 152.616c8.796 8.796 20.492 13.64 32.932 13.64 12.442 0 24.138-4.846 32.936-13.644 18.158-18.16 18.156-47.708-0.002-65.866l-141.318-141.318 0.094-0.094-40.484-40.486-14.162-13.97L192.812 127.492l146.47 0 0-92L101.16 35.492c-36.392 0-66 29.608-66 66l0 237.972 92 0L127.16 193.578z"p-id="1430"/><path d="M896.578 830.358l-73.198-73.198 0.034-0.034-40.44-40.44-14.148-14.084-152.622-152.62c-8.796-8.8-20.496-13.648-32.942-13.648-12.444 0-24.14 4.848-32.94 13.646-18.148 18.156-18.148 47.702 0.004 65.866l141.31 141.306-0.094 0.094 40.492 40.494 14.16 13.974 84.728 84.726-146.734 0 0 92 238.386 0c36.392 0 66-29.608 66-66l0-237.96-92 0L896.574 830.358z"p-id="1431"/></svg></div><div style="float: left;"><svg class="video-control-play dm-icon"viewbox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M836.1152 512 194.2848 886.4v-748.8000000000001L836.1152 512z"/></svg><svg class="video-control-paused dm-icon"style="display:none"viewbox="0 0 1024 1024"version="1.1"xmlns="http://www.w3.org/2000/svg"><path fill="#fff"d="M256.033769 192.014198l127.977743 0 0 639.933741-127.977743 0 0-639.933741ZM639.976 191.982l127.993 0 0 639.966-127.993 0 0-639.966z"/></svg><span class="video-control-nowtime">0:00</span></div><div class="tranger"><div class="tranger-a"></div><div class="tranger-b"></div><div class="tranger-c"></div></div></div></div></div></div>',tplayer.ele.warp.innerHTML=tplayer.v,tplayer.ele.video=$c(".dm-video")[0],tplayer.ele.dm_dmk=$c(".dm-dmk")[0],tplayer.ele.dm_text=$c(".dm-text")[0],tplayer.ele.dm_up=$c(".dm-up")[0],tplayer.ele.tp_color_bo=$c(".tp-color-bo")[0],tplayer.ele.video_control_play=$c(".video-control-play")[0],tplayer.ele.dm_oneplay=$c(".dm-oneplay")[0],tplayer.ele.danmu_warp=$c(".danmu-warp")[0],tplayer.ele.dm_video_y=$c(".dm-video-y")[0],tplayer.ele.video_control_paused=$c(".video-control-paused")[0],tplayer.ele.dm_syk_range=$c(".dm-syk-range")[0],tplayer.ele.alltime=$c(".video-control-alltime")[0],tplayer.ele.tranger_a=$c(".tranger-a")[0],tplayer.ele.tranger_c=$c(".tranger-c")[0],tplayer.ele.nowtime=$c(".video-control-nowtime")[0],tplayer.ele.dm_spinner=$c(".dm-spinner")[0],tplayer.ele.full=$c(".video-full")[0],tplayer.ele.tp_con=$c(".tp-con")[0],tplayer.ele.tp_color_warp=$c(".tp-color-warp")[0],tplayer.ele.tp_place=$c(".tp-place")[0],tplayer.ele.dm_send=$c(".dm-send")[0],tplayer.ele.tranger=$c(".tranger")[0],tplayer.ele.dm_video_warp=$c(".dm-video-warp")[0],tplayer.ele.tp_speend_con=$c(".tp-speend-con")[0],tplayer.ele.tp_speend=$c(".tp-speend")[0],tplayer.ele.dm_video=$c(".dm-video")[0],tplayer.ele.dm_video_warp=$c(".dm-video-warp")[0],tplayer.ele.dm_rightmenu=$c(".dm-rightmenu")[0],"flv"==tplayer.videotype?flvjs.isSupported()?(a=flvjs.createPlayer({type:"flv",url:tplayer.vsrc}),a.attachMediaElement(tplayer.ele.video),a.load()):console.log("flv.js没有加载完全"):tplayer.ele.video.src=tplayer.vsrc,tplayer.ele.video.poster=tplayer.vposter,tplayer.danmuelement=tplayer.ele.danmu_warp,tplayer.sjc=0,tplayer.dsq=0,tplayer.leftarr=[],tplayer.toparr=[],tplayer.dmheight=31,tplayer.dmplace=1,tplayer.width=tplayer.ele.video.offsetWidth,tplayer.height=tplayer.ele.video.offsetHeight,tplayer.getdanmu=function(){var a;a=new XMLHttpRequest,a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(tplayer.data=a.responseText,tplayer.nowdata=JSON.parse(tplayer.data).data)},a.open("GET",tplayer.geturl,!0),a.send()},tplayer.getdanmu(),tplayer.send=function(a,b,c,d){var e,f,g,h,i,j,k;tplayer.width=tplayer.ele.video.offsetWidth,tplayer.height=tplayer.ele.video.offsetHeight,e=document.createElement("div"),e.appendChild(document.createTextNode(a)),e.style.color=b,d&&(e.style.border="1px solid #fff"),1==c?(f=tplayer.getlefttop(),e.style.top=f*tplayer.dmheight+"px",tplayer.leftarr[f]=1,e.className="danmu dm-left",e.style.transform="translateX(-"+tplayer.width+"px)",g=tplayer.ele.danmu_warp.appendChild(e),h=g.offsetWidth,i=h+tplayer.width,j=i/10,k=h/j,setTimeout(function(){tplayer.leftarr[f]=0},1e3*k+500),e.addEventListener("webkitAnimationEnd",tplayer.dmend),e.addEventListener("animationend",tplayer.dmend)):2==c&&(e.className="danmu dm-top",f=tplayer.gettoptop(),e.style.top=f*tplayer.dmheight+"px",tplayer.toparr[f]=1,g=tplayer.ele.danmu_warp.appendChild(e),setTimeout(function(){tplayer.danmuhide(g,f)},5e3))},tplayer.dmend=function(){tplayer.danmuelement.removeChild(this)},tplayer.danmuhide=function(a,b){tplayer.ele.video.paused?setTimeout(function(){tplayer.danmuhide(a,b)},10*tplayer.width+1e3):(a.remove(),tplayer.toparr[b]=0)},tplayer.getlefttop=function(){var a,b;for(b=0;b<=tplayer.leftarr.length;b++)if(!tplayer.leftarr[b]){a=b;break}return a},tplayer.gettoptop=function(){var a,b;for(b=0;b<=tplayer.toparr.length;b++)if(!tplayer.toparr[b]){a=b;break}return a},tplayer.ele.dm_dmk.addEventListener("click",function(){"dm-dmk"==this.className?(this.className="dm-dmk dm-dmk-c",tplayer.ele.danmu_warp.style.opacity="0"):(this.className="dm-dmk",tplayer.ele.danmu_warp.style.opacity="1")}),tplayer.ele.dm_text.onkeydown=function(a){var b=a||window.event||arguments.callee.caller.arguments[0];13==b.keyCode&&tplayer.ele.dm_up.click()},tplayer.ele.dm_up.addEventListener("click",function(){var a,b;tplayer.send(tplayer.ele.dm_text.value,tplayer.ele.tp_color_bo.style.backgroundColor,tplayer.dmplace,1),tplayer.ele.dm_text.readonly="readonly",tplayer.ele.dm_up.disabled="true",tplayer.ele.dm_up.style.background="#777479",setTimeout(function(){tplayer.ele.dm_text.value="",tplayer.ele.dm_up.disabled="",tplayer.ele.dm_up.style.background="#8715EF"},500),a={id:tplayer.videoid,text:tplayer.ele.dm_text.value,color:tplayer.ele.tp_color_bo.style.backgroundColor,time:parseInt(10*tplayer.ele.video.currentTime),place:tplayer.dmplace},a=function(a){var c,b="";for(c in a)b+=c+"="+a[c]+"&";return b}(a),b=new XMLHttpRequest,b.open("POST",tplayer.sendurl,!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.onreadystatechange=function(){var c,a=b;4==a.readyState&&200==a.status&&(c=a.responseText,console.log(c))},b.send(a)}),tplayer.ele.video_control_play.onclick=function(){var a,b;for(tplayer.ele.dm_oneplay.style.display="none",0==tplayer.dsq&&(tplayer.Interval=setInterval(e,100),tplayer.dsq=1),tplayer.ele.dm_video_y.style.opacity="0",a=tplayer.ele.danmu_warp.getElementsByTagName("div"),this.style.display="none",tplayer.ele.video_control_paused.style.display="inline-block",tplayer.ele.video.play(),b=a.length-1;b>=0;b--)removeClass(a[b],"dm-suspend")},tplayer.ele.video_control_paused.onclick=function(){var a,b;for(clearInterval(tplayer.Interval),tplayer.dsq=0,a=tplayer.ele.danmu_warp.getElementsByTagName("div"),this.style.display="none",tplayer.ele.video_control_play.style.display="inline-block",tplayer.ele.video.pause(),b=a.length-1;b>=0;b--)addClass(a[b],"dm-suspend");tplayer.ele.dm_spinner.style.display="none"},tplayer.ele.dm_oneplay.addEventListener("click",function(){this.style.display="none",tplayer.ele.video_control_play.onclick()}),tplayer.ele.dm_video_y.onmousemove=function(){l()},tplayer.changersound=function(){var a=7,b=new Date;b.setTime(b.getTime()+1e3*60*60*24*a),document.cookie="tpsound="+parseInt(tplayer.ele.dm_syk_range.value)+";expires="+b.toGMTString()+"&path=/"},tplayer.soundcookie=c("tpsound"),tplayer.soundcookie?(tplayer.ele.dm_syk_range.value=tplayer.soundcookie,tplayer.ele.video.volume=.01*parseInt(tplayer.ele.dm_syk_range.value)):tplayer.changersound(),d(),tplayer.ele.dm_syk_range.addEventListener("click",function(){var a=.01*parseInt(tplayer.ele.dm_syk_range.value);tplayer.ele.video.volume=a,tplayer.changersound()}),setInterval(function(){var b,a=tplayer.ele.video.currentTime;tplayer.ele.nowtime.innerHTML=k(a).m+":"+k(a).s,b=tplayer.ele.dm_send.offsetWidth-280+"px",tplayer.ele.dm_text.style.width!=b&&(tplayer.ele.dm_text.style.width=b)},1e3),tplayer.ele.tranger.onmousedown=function(a){var b=a||window.event||arguments.callee.caller.arguments[0],c=h(b,this);tplayer.ele.tranger_a.style.width=100*c.xbl+"%",tplayer.ele.video.currentTime=c.xbl*tplayer.alltime,tplayer.nowdata=JSON.parse(tplayer.data).data},tplayer.ele.video.addEventListener("waiting",j),tplayer.ele.video.addEventListener("playing",function(){var a,b;for(0==tplayer.dsq&&(tplayer.Interval=setInterval(e,100),tplayer.dsq=1),a=tplayer.ele.danmu_warp.getElementsByTagName("div"),tplayer.ele.dm_spinner.style.display="none",tplayer.ele.alltime.innerHTML=k(tplayer.alltime).m+":"+k(tplayer.alltime).s,b=a.length-1;b>=0;b--)removeClass(a[b],"dm-suspend")}),document.onkeydown=function(a){var c,b=a||window.event||arguments.callee.caller.arguments[0];l(),b&&39==b.keyCode&&(c=tplayer.ele.video.currentTime,tplayer.ele.video.currentTime=c+5),b&&37==b.keyCode&&(c=tplayer.ele.video.currentTime,tplayer.ele.video.currentTime=c-5,tplayer.nowdata=JSON.parse(tplayer.data).data),b&&32==b.keyCode&&(tplayer.ele.video.paused?tplayer.ele.video_control_play.onclick():tplayer.ele.video_control_paused.onclick()),b&&38==b.keyCode&&(tplayer.ele.dm_syk_range.value=parseInt(tplayer.ele.dm_syk_range.value)+1,tplayer.ele.dm_syk_range.click()),b&&40==b.keyCode&&(tplayer.ele.dm_syk_range.value=parseInt(tplayer.ele.dm_syk_range.value)-1,tplayer.ele.dm_syk_range.click())},tplayer.ele.full.addEventListener("click",function(){var a=tplayer.ele.dm_video_warp;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(),setTimeout(function(){var a,c;for(tplayer.width=tplayer.ele.video.offsetWidth,a=tplayer.ele.danmu_warp.getElementsByTagName("div"),b(tplayer.width/100),c=a.length-1;c>=0;c--)hasClass(a[c],"dm-left")&&(a[c].style.transform="translateX(-"+tplayer.width+"px)")},1e3)}),tpcolor=new Object,tpcolor.arr=new Array("#FFFFFF","#000000","#4ab0c6","#555656","#09b745","#f86141","#FFEB3B","#4d38d8","#fe67c1","#ff9c07"),n=255;n>=0;n-=25)for(o=0;255>=o;o+=25)for(p=0;255>=p;p+=25)tpcolor.arr.push("rgb("+n+","+o+","+p+")");for(q=tplayer.ele.tp_con,r=tplayer.ele.tp_color_warp,tplayer.ele.tp_color_bo.addEventListener("click",function(){q.style.display="block"==q.style.display?"none":"block"}),tpcolor.i=0;tpcolor.i<tpcolor.arr.length;tpcolor.i++)s=document.createElement("div"),s.className="tp-color",t=document.createElement("div"),t.className="tp-color-main",t.style.background=tpcolor.arr[tpcolor.i],t.addEventListener("click",function(){tplayer.ele.tp_color_bo.style.backgroundColor=this.style.background}),s.appendChild(t),r.appendChild(s);for(tplayer.ele.tp_speend_con.addEventListener("click",function(){var a=tplayer.ele.tp_speend;a.style.display="block"==a.style.display?"none":"block"}),u=tplayer.ele.tp_speend.childNodes,i=0;i<u.length;i++)v=u[i],w=parseFloat(u[i].innerText).toFixed(2),v.onclick="NaN"!=w?function(){var a=parseFloat(this.innerText).toFixed(2);tplayer.ele.dm_video.playbackRate=a}:function(){tplayer.ele.dm_video.playbackRate=1};tplayer.ele.danmu_warp.onmousedown=function(a){var e,f,g,h,i,j,k,b=a||window.event||arguments.callee.caller.arguments[0],c=tplayer.ele.dm_video_warp,d=tplayer.ele.dm_rightmenu;2==b.button?(d.style.display="block",e=window.event||arguments[0],h=tplayer.ele.danmu_warp.offsetHeight,i=tplayer.ele.danmu_warp.offsetWidth,h==document.documentElement.clientHeight?(g=e.clientY,f=e.clientX,f+d.offsetWidth>i&&(f=i-d.offsetWidth),g+d.offsetWidth>h&&(g=h-d.offsetHeight)):(g=e.clientY+document.body.scrollTop-c.offsetTop,f=e.clientX-c.offsetLeft,j=c.offsetWidth,k=c.offsetHeight,f+d.offsetWidth>j&&(f=j-d.offsetWidth),g+d.offsetHeight>k&&(g=k-d.offsetHeight)),window.document.all?(this.IContextmenuHander=function(){return!1},document.attachEvent("oncontextmenu",this.IContextmenuHander)):(this.IContextmenuHander=document.oncontextmenu,document.oncontextmenu=function(){return!1}),d.style.top=g+"px",d.style.left=f+"px"):0==b.button&&("block"==d.style.display?d.style.display="none":tplayer.ele.video.paused?tplayer.ele.video_control_play.onclick():tplayer.ele.video_control_paused.onclick())},tplayer.ele.tp_place.addEventListener("click",function(){1==tplayer.dmplace?(tplayer.dmplace=2,this.innerText="▲顶部弹幕"):(tplayer.dmplace=1,this.innerText="◀滚动弹幕")})}}var tplayer=new Object;